<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Betterlin ’s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="程序人生">
<meta property="og:type" content="website">
<meta property="og:title" content="Betterlin ’s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Betterlin ’s Blog">
<meta property="og:description" content="程序人生">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Betterlin ’s Blog">
<meta name="twitter:description" content="程序人生">
  
    <link rel="alternate" href="/atom.xml" title="Betterlin ’s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <nav class="navgator outer">
  <div id="header-inner" class="inner">
    <nav id="main-nav">
      <a id="main-nav-toggle" class="nav-icon"></a>
      
        <a class="main-nav-link" href="/">主页</a>
      
        <a class="main-nav-link" href="/archives">归档</a>
      
        <a class="main-nav-link" href="/about">个人</a>
      
    </nav>
    <nav id="sub-nav">
      
        <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
      
      <a id="nav-search-btn" class="nav-icon" title="Search"></a>
    </nav>
    <div id="search-form-wrap">
      <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
    </div>
  </div>
</nav>
<header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Betterlin ’s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">浪住, 别稳, 能输!</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-前端必备知识库之ES6篇" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2019/04/25/前端必备知识库之ES6篇/" class="article-date">
  <time datetime="2019-04-24T17:20:06.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/前端必备知识库之ES6篇/">前端必备知识库之ES6篇</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="声明-let、const"><a href="#声明-let、const" class="headerlink" title="声明 let、const"></a>声明 let、const</h2><h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><h2 id="声明类与继承：class、extend"><a href="#声明类与继承：class、extend" class="headerlink" title="声明类与继承：class、extend"></a>声明类与继承：class、extend</h2><h2 id="Promise的使用与实现"><a href="#Promise的使用与实现" class="headerlink" title="Promise的使用与实现"></a>Promise的使用与实现</h2><h2 id="generator（异步编程、yield、next-、await-、async）"><a href="#generator（异步编程、yield、next-、await-、async）" class="headerlink" title="generator（异步编程、yield、next()、await 、async）"></a>generator（异步编程、yield、next()、await 、async）</h2><h2 id="箭头函数this指向问题、拓展运算符"><a href="#箭头函数this指向问题、拓展运算符" class="headerlink" title="箭头函数this指向问题、拓展运算符"></a>箭头函数this指向问题、拓展运算符</h2><h2 id="map和set有没有用过，如何实现一个数组去重，map数据结构有什么优点？"><a href="#map和set有没有用过，如何实现一个数组去重，map数据结构有什么优点？" class="headerlink" title="map和set有没有用过，如何实现一个数组去重，map数据结构有什么优点？"></a>map和set有没有用过，如何实现一个数组去重，map数据结构有什么优点？</h2><h2 id="ES6怎么编译成ES5-css-loader原理-过程"><a href="#ES6怎么编译成ES5-css-loader原理-过程" class="headerlink" title="ES6怎么编译成ES5,css-loader原理,过程"></a>ES6怎么编译成ES5,css-loader原理,过程</h2><h2 id="ES6转成ES5的常见例子"><a href="#ES6转成ES5的常见例子" class="headerlink" title="ES6转成ES5的常见例子"></a>ES6转成ES5的常见例子</h2><h3 id="使用es5实现es6的class"><a href="#使用es5实现es6的class" class="headerlink" title="使用es5实现es6的class"></a>使用es5实现es6的class</h3><p>缓慢补充中~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/25/前端必备知识库之ES6篇/" data-id="ckrbiagst000j6h1ti9ll4wih" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-前端必备知识库之Js篇" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2019/04/25/前端必备知识库之Js篇/" class="article-date">
  <time datetime="2019-04-24T17:17:18.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/前端必备知识库之Js篇/">前端必备知识库之Js篇</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="原型-原型链-构造函数-实例-继承"><a href="#原型-原型链-构造函数-实例-继承" class="headerlink" title="原型/原型链/构造函数/实例/继承"></a>原型/原型链/构造函数/实例/继承</h2><h2 id="有几种方式可以实现继承"><a href="#有几种方式可以实现继承" class="headerlink" title="有几种方式可以实现继承"></a>有几种方式可以实现继承</h2><h2 id="用原型实现继承有什么缺点，怎么解决"><a href="#用原型实现继承有什么缺点，怎么解决" class="headerlink" title="用原型实现继承有什么缺点，怎么解决"></a>用原型实现继承有什么缺点，怎么解决</h2><h2 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h2><h2 id="数据类型判断"><a href="#数据类型判断" class="headerlink" title="数据类型判断"></a>数据类型判断</h2><h2 id="作用域链、闭包、作用域"><a href="#作用域链、闭包、作用域" class="headerlink" title="作用域链、闭包、作用域"></a>作用域链、闭包、作用域</h2><h2 id="Ajax的原生写法"><a href="#Ajax的原生写法" class="headerlink" title="Ajax的原生写法"></a>Ajax的原生写法</h2><h2 id="对象深拷贝、浅拷贝"><a href="#对象深拷贝、浅拷贝" class="headerlink" title="对象深拷贝、浅拷贝"></a>对象深拷贝、浅拷贝</h2><h2 id="图片懒加载、预加载"><a href="#图片懒加载、预加载" class="headerlink" title="图片懒加载、预加载"></a>图片懒加载、预加载</h2><h2 id="实现页面加载进度条"><a href="#实现页面加载进度条" class="headerlink" title="实现页面加载进度条"></a>实现页面加载进度条</h2><h2 id="this关键字"><a href="#this关键字" class="headerlink" title="this关键字"></a>this关键字</h2><h2 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h2><h2 id="手动实现parseInt"><a href="#手动实现parseInt" class="headerlink" title="手动实现parseInt"></a>手动实现parseInt</h2><h2 id="为什么会有同源策略"><a href="#为什么会有同源策略" class="headerlink" title="为什么会有同源策略"></a>为什么会有同源策略</h2><h2 id="怎么判断两个对象是否相等"><a href="#怎么判断两个对象是否相等" class="headerlink" title="怎么判断两个对象是否相等"></a>怎么判断两个对象是否相等</h2><h2 id="事件模型"><a href="#事件模型" class="headerlink" title="事件模型"></a>事件模型</h2><h3 id="事件委托、代理"><a href="#事件委托、代理" class="headerlink" title="事件委托、代理"></a>事件委托、代理</h3><h3 id="如何让事件先冒泡后捕获"><a href="#如何让事件先冒泡后捕获" class="headerlink" title="如何让事件先冒泡后捕获"></a>如何让事件先冒泡后捕获</h3><h2 id="window的onload事件和domcontentloaded"><a href="#window的onload事件和domcontentloaded" class="headerlink" title="window的onload事件和domcontentloaded"></a>window的onload事件和domcontentloaded</h2><h2 id="for…in迭代和for…of有什么区别"><a href="#for…in迭代和for…of有什么区别" class="headerlink" title="for…in迭代和for…of有什么区别"></a>for…in迭代和for…of有什么区别</h2><h2 id="函数柯里化"><a href="#函数柯里化" class="headerlink" title="函数柯里化"></a>函数柯里化</h2><h2 id="call-apply区别，原生实现bind"><a href="#call-apply区别，原生实现bind" class="headerlink" title="call apply区别，原生实现bind"></a>call apply区别，原生实现bind</h2><h3 id="call，apply，bind-三者用法和区别：角度可为参数、绑定规则（显示绑定和强绑定），运行效率、运行情况。"><a href="#call，apply，bind-三者用法和区别：角度可为参数、绑定规则（显示绑定和强绑定），运行效率、运行情况。" class="headerlink" title="call，apply，bind 三者用法和区别：角度可为参数、绑定规则（显示绑定和强绑定），运行效率、运行情况。"></a>call，apply，bind 三者用法和区别：角度可为参数、绑定规则（显示绑定和强绑定），运行效率、运行情况。</h3><h2 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h2><h2 id="立即执行函数和使用场景"><a href="#立即执行函数和使用场景" class="headerlink" title="立即执行函数和使用场景"></a>立即执行函数和使用场景</h2><h2 id="设计模式-要求说出如何实现-应用-优缺点-单例模式实现"><a href="#设计模式-要求说出如何实现-应用-优缺点-单例模式实现" class="headerlink" title="设计模式(要求说出如何实现,应用,优缺点)/单例模式实现"></a>设计模式(要求说出如何实现,应用,优缺点)/单例模式实现</h2><h2 id="iframe的缺点有哪些"><a href="#iframe的缺点有哪些" class="headerlink" title="iframe的缺点有哪些"></a>iframe的缺点有哪些</h2><h2 id="数组问题"><a href="#数组问题" class="headerlink" title="数组问题"></a>数组问题</h2><h3 id="数组去重"><a href="#数组去重" class="headerlink" title="数组去重"></a>数组去重</h3><h3 id="数组常用方法"><a href="#数组常用方法" class="headerlink" title="数组常用方法"></a>数组常用方法</h3><h3 id="查找数组重复项"><a href="#查找数组重复项" class="headerlink" title="查找数组重复项"></a>查找数组重复项</h3><h3 id="扁平化数组"><a href="#扁平化数组" class="headerlink" title="扁平化数组"></a>扁平化数组</h3><h3 id="按数组中各项和特定值差值排序"><a href="#按数组中各项和特定值差值排序" class="headerlink" title="按数组中各项和特定值差值排序"></a>按数组中各项和特定值差值排序</h3><h2 id="BOM属性对象方法"><a href="#BOM属性对象方法" class="headerlink" title="BOM属性对象方法"></a>BOM属性对象方法</h2><h2 id="服务端渲染"><a href="#服务端渲染" class="headerlink" title="服务端渲染"></a>服务端渲染</h2><h2 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h2><h2 id="eventloop"><a href="#eventloop" class="headerlink" title="eventloop"></a>eventloop</h2><h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h3><h3 id="任务队列"><a href="#任务队列" class="headerlink" title="任务队列"></a>任务队列</h3><h2 id="如何快速让字符串变成已千为精度的数字"><a href="#如何快速让字符串变成已千为精度的数字" class="headerlink" title="如何快速让字符串变成已千为精度的数字"></a>如何快速让字符串变成已千为精度的数字</h2><p>缓慢补充中~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/25/前端必备知识库之Js篇/" data-id="ckrbiagsy000q6h1tugeyu2pc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-前端必备知识库之Html篇" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2019/04/25/前端必备知识库之Html篇/" class="article-date">
  <time datetime="2019-04-24T17:16:20.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/前端必备知识库之Html篇/">前端必备知识库之Html篇</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="语义化"><a href="#语义化" class="headerlink" title="语义化"></a>语义化</h2><h2 id="新标签新特性"><a href="#新标签新特性" class="headerlink" title="新标签新特性"></a>新标签新特性</h2><h2 id="input和textarea的区别"><a href="#input和textarea的区别" class="headerlink" title="input和textarea的区别"></a>input和textarea的区别</h2><h2 id="用一个div模拟textarea的实现"><a href="#用一个div模拟textarea的实现" class="headerlink" title="用一个div模拟textarea的实现"></a>用一个div模拟textarea的实现</h2><h2 id="移动设备忽略将页面中的数字识别为电话号码的方法"><a href="#移动设备忽略将页面中的数字识别为电话号码的方法" class="headerlink" title="移动设备忽略将页面中的数字识别为电话号码的方法"></a>移动设备忽略将页面中的数字识别为电话号码的方法</h2><p>缓慢补充中~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/25/前端必备知识库之Html篇/" data-id="ckrbiagsw000n6h1tdt9snfcq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Html/">Html</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-前端必备知识库之CSS篇" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2019/04/25/前端必备知识库之CSS篇/" class="article-date">
  <time datetime="2019-04-24T17:13:52.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/前端必备知识库之CSS篇/">前端必备知识库之CSS篇</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="盒模型"><a href="#盒模型" class="headerlink" title="盒模型"></a>盒模型</h2><p>盒子模型有两种，标准模型和IE盒模型</p>
<p><img src="/images/标准模型.png" alt="标准模型"><br><img src="/images/IE模型.png" alt="IE模型"></p>
<p>标准模型：宽高部分只包含content部分<br>IE模型： 宽高包含content + padding + border</p>
<h2 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h2><h2 id="css单位"><a href="#css单位" class="headerlink" title="css单位"></a>css单位</h2><h2 id="css选择器"><a href="#css选择器" class="headerlink" title="css选择器"></a>css选择器</h2><h2 id="bfc-清除浮动"><a href="#bfc-清除浮动" class="headerlink" title="bfc 清除浮动"></a>bfc 清除浮动</h2><h2 id="层叠上下文"><a href="#层叠上下文" class="headerlink" title="层叠上下文"></a>层叠上下文</h2><h2 id="常见页面布局"><a href="#常见页面布局" class="headerlink" title="常见页面布局"></a>常见页面布局</h2><h2 id="响应式布局"><a href="#响应式布局" class="headerlink" title="响应式布局"></a>响应式布局</h2><h2 id="css预处理，后处理"><a href="#css预处理，后处理" class="headerlink" title="css预处理，后处理"></a>css预处理，后处理</h2><h2 id="css3新特性"><a href="#css3新特性" class="headerlink" title="css3新特性"></a>css3新特性</h2><h2 id="animation和transiton的相关属性"><a href="#animation和transiton的相关属性" class="headerlink" title="animation和transiton的相关属性"></a>animation和transiton的相关属性</h2><h2 id="animate和translate"><a href="#animate和translate" class="headerlink" title="animate和translate"></a>animate和translate</h2><h2 id="display哪些取值"><a href="#display哪些取值" class="headerlink" title="display哪些取值"></a>display哪些取值</h2><h2 id="相邻的两个inline-block节点为什么会出现间隔，该如何解决"><a href="#相邻的两个inline-block节点为什么会出现间隔，该如何解决" class="headerlink" title="相邻的两个inline-block节点为什么会出现间隔，该如何解决"></a>相邻的两个inline-block节点为什么会出现间隔，该如何解决</h2><h2 id="meta-viewport-移动端适配"><a href="#meta-viewport-移动端适配" class="headerlink" title="meta viewport 移动端适配"></a>meta viewport 移动端适配</h2><h2 id="CSS实现宽度自适应100-，宽高16-9的比例的矩形"><a href="#CSS实现宽度自适应100-，宽高16-9的比例的矩形" class="headerlink" title="CSS实现宽度自适应100%，宽高16:9的比例的矩形"></a>CSS实现宽度自适应100%，宽高16:9的比例的矩形</h2><h2 id="rem布局的优缺点"><a href="#rem布局的优缺点" class="headerlink" title="rem布局的优缺点"></a>rem布局的优缺点</h2><h2 id="画三角形"><a href="#画三角形" class="headerlink" title="画三角形"></a>画三角形</h2><h2 id="1像素边框问题"><a href="#1像素边框问题" class="headerlink" title="1像素边框问题"></a>1像素边框问题</h2><p>缓慢补充中~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/25/前端必备知识库之CSS篇/" data-id="ckrbiagsr000g6h1t2igsupva" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Css/">Css</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-浏览器缓存中的HTTP缓存" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2019/04/22/浏览器缓存中的HTTP缓存/" class="article-date">
  <time datetime="2019-04-22T14:30:06.000Z" itemprop="datePublished">2019-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/22/浏览器缓存中的HTTP缓存/">浏览器缓存中的HTTP缓存</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>缓存是一把双刃剑，既能帮你，也会害你。正确地使用缓存策略，能够让用户访问网页的速度大幅提升。</p>
</blockquote>
<p><img src="/images/cache.png" alt="cache"></p>
<h2 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h2><p>缓存是一种保存资源副本并在下次请求时直接使用该副本的技术。当 web 缓存发现请求的资源已经被存储，它会拦截请求，返回该资源的拷贝，而不会去源服务器重新下载。</p>
<h2 id="缓存带来的优点"><a href="#缓存带来的优点" class="headerlink" title="缓存带来的优点"></a>缓存带来的优点</h2><ul>
<li>减少网络请求延迟，提高页面访问速度</li>
<li>降低服务器请求压力</li>
<li>减少网络带宽的消耗，比如资源存放cdn的情况，减少带宽的使用，有效降低成本。</li>
</ul>
<h2 id="HTTP缓存"><a href="#HTTP缓存" class="headerlink" title="HTTP缓存"></a>HTTP缓存</h2><p>常见的HTTP缓存只能缓存 GET 响应，对于其他类型的响应比如 (post, put, delete) 则无能为力。</p>
<h2 id="强缓存"><a href="#强缓存" class="headerlink" title="强缓存"></a>强缓存</h2><p>强缓存是指通过使用Http的响应头 Expires 或 Cache-Control 对资源进行缓存有效期进行设置。两者都是通过控制资源的有效期来实现缓存策略，当对应的资源在有效期内命中，浏览器则不向后端发送通信，直接使用缓存策略命中的资源，一般浏览器会显示 from dist cache 和 from memory cache 两种。</p>
<p>这两者该如何去使用呢？有什么区别？</p>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>Expires是Http 1.0的产物，其实用法是后端在Http的响应头设置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expires: Apr, 22 2019 23:58:12 GMT</span><br></pre></td></tr></table></figure></p>
<p>其中是通过设置了一个时间戳，浏览器下次进行资源获取的时候会对比当前时间和此时间戳，如果当前时间小于该时间戳，就表示缓存仍在有效期中命中。如果要让缓存失效，则配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expires: -1</span><br></pre></td></tr></table></figure>
<p>由以上可发现问题，Expires依赖客户端本地时间，如果客户端的本地时间错误，就会让缓存策略失效，于是Http 1.1就新增了 Cache-Control 来替代 Expires。</p>
<h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>Cache-Control 可配置的字段比较多，我们逐个来了解</p>
<p>no-cache: 强制确认缓存，浏览器获取资源时，浏览器都要向服务器进行通信验证缓存是否命中。</p>
<p>no-store: 禁止进行缓存， 强制浏览器在任何情况下都不要保留任何副本，也就是不进行任何缓存策略。</p>
<p>public: 公共缓存，任何路径的缓存者（CDN、代理服务器），可以无条件的缓存改资源。</p>
<p>private: 私有缓存，只针对单个用户或者实体（不同用户、窗口）缓存资源。</p>
<p>max-age=<seconds>: 通过设置时间长度 max-age，表示距离请求发起的时间的秒数，判断该资源在此时间范围内以内是否命中，避免时间戳带来的问题。</seconds></p>
<p>s-maxage=<seconds>: s-maxage 优先级高于 max-age，s-maxage 用于表示 cache 服务器上（比如 CDN）的缓存的有效时间，并只对 public 缓存有效。</seconds></p>
<p>可见 Cache-Control 的功能比 Expires 完善，而且优先级更高。</p>
<h2 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h2><p>协商缓存依赖于浏览器于服务器端进行通信，浏览器需要向服务器询问当前资源是否命中缓存有效期。当请求讯问的资源命中缓存，则服务器会返回Http响应码304务端告知浏览器缓存资源命中，请求会被重定向到浏览器缓存。</p>
<h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>服务器在首次返回资源的响应中通过设置响应头 Last-Modified 当前的时间戳</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Last-Modified: Apr, 22 2019 23:58:12 GMT</span><br></pre></td></tr></table></figure>
<p>浏览器下次重新获取资源时与服务器进行通信进行协商缓存命中确认，会带上请求头 If-Modified-Since</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Modified-Since: Apr, 22 2019 23:58:12 GMT</span><br></pre></td></tr></table></figure>
<p>服务器接收到 If-Modified-Since 的时间戳后，比对次时间戳和资源在服务器上的最后修改时间是否一致，从而判断资源是否发生了变化。如果发生了变化，就会返回一个完整的响应内容，并在 Response Headers 中添加新的 Last-Modified 值；否则，则命中缓存，返回 304 响应，并且响应头不会再添加 Last-Modified 字段。</p>
<p>Last-Modified 存在一定的弊端，一个是，当编辑后的资源内容没有改变，但服务器端会认为资源被更新，因为其判断是根据文件最后编辑时间。另一个是，当修改文件速度很快，而 If-Modified-Since 的时间戳和与最后修改时间的差距无法被计算出来，所以会认为资源没有进行更新。</p>
<h3 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h3><p>服务器首次返回资源设置响应头 ETag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ETag: W/&quot;2123-420d462f951&quot;</span><br></pre></td></tr></table></figure>
<p>浏览器下次重新获取资源时与服务器进行通信进行协商缓存命中确认，会带上请求头 If-None-Match</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-None-Match: W/&quot;2123-420d462f951&quot;</span><br></pre></td></tr></table></figure>
<p>服务器接收到 If-None-Match 的资源标识后，比对当前服务器资源的标识和 If-None-Match 的资源标识是否一样，从而判断资源是否发生了变化。如果发生了变化，就会返回一个完整的响应内容，并在 Response Headers 中添加新的 ETag 值；否则，则命中缓存，返回 304 响应，并且响应头不会再添加 ETag 字段。</p>
<p>Etag通过对资源进行内容的HASH计算，生成资源的标识。这样可以有效的避免 Last-Modified 的弊端，但 Etag 依赖于服务器端进行计算，会影响服务器性能。</p>
<p>最后用一张图标总结所有：</p>
<p><img src="/images/cache-process.png" alt="cache-process"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/22/浏览器缓存中的HTTP缓存/" data-id="ckrbiagt700176h1tmwe8f81u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Browser/">Browser</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Http/">Http</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2019我和前端有一个约定" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2019/04/22/2019我和前端有一个约定/" class="article-date">
  <time datetime="2019-04-21T16:59:33.000Z" itemprop="datePublished">2019-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/22/2019我和前端有一个约定/">2019我和前端有一个约定</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="规范简介"><a href="#规范简介" class="headerlink" title="规范简介"></a>规范简介</h2><blockquote>
<p>该规范目的是保证前端代码的整洁性和代码风格一致性，提高代码的可读性和可维护性。</p>
</blockquote>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><h3 id="项目命名"><a href="#项目命名" class="headerlink" title="项目命名"></a>项目命名</h3><p>全部采用小写方式，使用中划线 - 进行分隔</p>
<h3 id="目录结构规范"><a href="#目录结构规范" class="headerlink" title="目录结构规范"></a>目录结构规范</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"> |-- src</span><br><span class="line"> |    |-- libs // 公用的库文件，例如：主题样式，鉴权插件，定制化的图表库</span><br><span class="line"> |    |-- assets // 资源目录，比如png，jpg，svg图片等</span><br><span class="line"> |    |    |-- images</span><br><span class="line"> |    |         |-- svg // svg的图片单独放一个目录</span><br><span class="line"> |    |-- components // 通用的自定义组件</span><br><span class="line"> |    |-- pages // 页面</span><br><span class="line"> |-- config // webpack等前端配置文件</span><br></pre></td></tr></table></figure>
<h3 id="目录文件命名规范（推荐2种）"><a href="#目录文件命名规范（推荐2种）" class="headerlink" title="目录文件命名规范（推荐2种）"></a>目录文件命名规范（推荐2种）</h3><ul>
<li>目录和文件都使用小写单词并使用中划线 - 进行分隔</li>
<li>目录和文件使用小写单词并使用中划线 - 进行分隔，唯独.vue组件使用大驼峰进行命名<h3 id="package-json管理"><a href="#package-json管理" class="headerlink" title="package.json管理"></a>package.json管理</h3></li>
<li><p>对于项目中代码需要依赖引入的使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i vue -S</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于项目中开发环境下进行运行调试压缩编译的使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i wepack -D</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于npm包的管理一定要规范，不需要引入的不要随便安装并写入package.json文件，当需要引入新的依赖需要告知所有的项目成员。</p>
</li>
<li>npm的依赖包的版本需要谨慎操作，不要随便进行任意升级。中间版本号和小版本号可以进行定期升级，并commit对应的修改以及通知项目成员。而大版本号需要确定其版本是否兼容目前使用的版本并进行仔细的测试才可以提交修改。<h2 id="HTML书写规范"><a href="#HTML书写规范" class="headerlink" title="HTML书写规范"></a>HTML书写规范</h2><h3 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h3></li>
<li>使用2个空格进行缩进</li>
<li>嵌套的节点应该使用缩进</li>
<li>节点属性使用双引号，而不用单引号</li>
<li><p>非自动闭合的HTML元素一定要使用斜线进行闭合！！！，自动闭合HTML元素则可选, 举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/logo.png"</span> <span class="attr">alt</span>=<span class="string">"logo"</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对于HTML 元素属性大于3个，推荐使用如下方式(适用于vue模板)，避免代码横向增长：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"switch-btn"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">:class</span>=<span class="string">"switchBtnIcon"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">:style</span>=<span class="string">"switchBtnLeftDistance"</span></span></span><br><span class="line"><span class="tag">   @<span class="attr">click</span>=<span class="string">"changeVisible"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="语义化"><a href="#语义化" class="headerlink" title="语义化"></a>语义化</h3><ul>
<li>根据使用场景选择正确的 HTML 元素。例如，使用 h1 元素创建标题，p 元素创建段落，a 元素创建链接，i 元素创建图标等等。正确的使用 HTML 元素对于可访问性、可重用性以及编码效率都很重要。<h3 id="资源引入"><a href="#资源引入" class="headerlink" title="资源引入"></a>资源引入</h3></li>
<li>引入资源使用相对路径，不要指定资源所带的具体协议 ( http:,https: ) ，除非这两者协议都不可用。<br>示例：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//ticket1000-1253841380.file.myqcloud.com/assets/release/vue/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="优化Dom结构"><a href="#优化Dom结构" class="headerlink" title="优化Dom结构"></a>优化Dom结构</h3><ul>
<li>尽量避免多余的父节点，通过迭代和重构来使HTML元素变得更少。<h3 id="属性顺序"><a href="#属性顺序" class="headerlink" title="属性顺序"></a>属性顺序</h3></li>
<li>class</li>
<li>id</li>
<li>name</li>
<li>data-*</li>
<li>src,for,type,href,value,max-length,max,min,pattern</li>
<li>placeholder,title,alt</li>
<li>aria-*,role</li>
<li>required,readonly,disabled<h2 id="CSS书写规范"><a href="#CSS书写规范" class="headerlink" title="CSS书写规范"></a>CSS书写规范</h2><h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3></li>
<li>类名使用小写字母，以中划线分隔</li>
<li>id采用驼峰式命名</li>
<li>less, scss中的变量、函数、混合、placeholder采用驼峰式命名<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3></li>
<li>每个属性声明末尾都要加分号</li>
<li>去掉小数点前面的0</li>
<li>去掉数字中不必要的小数点和末尾的0</li>
<li>属性值’0’后面不要加单位</li>
<li>用border: 0;代替border: none;</li>
<li>选择器不要超过4层</li>
<li>尽量少用’*’选择器<h3 id="需要加空格"><a href="#需要加空格" class="headerlink" title="需要加空格"></a>需要加空格</h3></li>
<li>属性值前</li>
<li>选择器 ‘&gt;’, ‘+’, ‘~’前后</li>
<li>‘{‘前</li>
<li>!important’!’前</li>
<li>@else前后</li>
<li>属性值中的’,’后</li>
<li>注释’/<em>‘后和’</em>/‘前<h3 id="需要换行"><a href="#需要换行" class="headerlink" title="需要换行"></a>需要换行</h3></li>
<li>‘{‘后和’}’前</li>
<li>每个属性独占一行</li>
<li>多个规则的分隔符’,’后<h3 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h3></li>
<li>尽量使用16进制的颜色，当不需要控制透明度，避免使用rgba的写法。</li>
<li>16进制的颜色尽量使用简写代替<h3 id="属性顺序-1"><a href="#属性顺序-1" class="headerlink" title="属性顺序"></a>属性顺序</h3></li>
<li><p>简单示例：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.order</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">float</span>: right;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e5e5e5</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">font</span>: normal <span class="number">13px</span> <span class="string">"Helvetica Neue"</span>, sans-serif;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>完整顺序：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"display"</span>,</span><br><span class="line">        <span class="string">"visibility"</span>,</span><br><span class="line">        <span class="string">"float"</span>,</span><br><span class="line">        <span class="string">"clear"</span>,</span><br><span class="line">        <span class="string">"overflow"</span>,</span><br><span class="line">        <span class="string">"clip"</span>,</span><br><span class="line">        <span class="string">"zoom"</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"position"</span>,</span><br><span class="line">        <span class="string">"top"</span>,</span><br><span class="line">        <span class="string">"right"</span>,</span><br><span class="line">        <span class="string">"bottom"</span>,</span><br><span class="line">        <span class="string">"left"</span>,</span><br><span class="line">        <span class="string">"z-index"</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"margin"</span>,</span><br><span class="line">        <span class="string">"box-sizing"</span>,</span><br><span class="line">        <span class="string">"border"</span>,</span><br><span class="line">        <span class="string">"border-radius"</span>,</span><br><span class="line">        <span class="string">"padding"</span>,</span><br><span class="line">        <span class="string">"width"</span>,</span><br><span class="line">        <span class="string">"height"</span>,</span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"font"</span>,</span><br><span class="line">        <span class="string">"line-height"</span>,</span><br><span class="line">        <span class="string">"text-align"</span>,</span><br><span class="line">        <span class="string">"vertical-align"</span>,</span><br><span class="line">        <span class="string">"white-space"</span>,</span><br><span class="line">        <span class="string">"text-decoration"</span>,</span><br><span class="line">        <span class="string">"word-spacing"</span>,</span><br><span class="line">        <span class="string">"text-overflow"</span>,</span><br><span class="line">        <span class="string">"word-wrap"</span>,</span><br><span class="line">        <span class="string">"word-break"</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"color"</span>,</span><br><span class="line">        <span class="string">"background"</span>,</span><br><span class="line">        <span class="string">"background-color"</span>,</span><br><span class="line">        <span class="string">"background-image"</span>,</span><br><span class="line">        <span class="string">"background-repeat"</span>,</span><br><span class="line">        <span class="string">"background-attachment"</span>,</span><br><span class="line">        <span class="string">"background-position"</span>,</span><br><span class="line">        <span class="string">"background-clip"</span>,</span><br><span class="line">        <span class="string">"background-origin"</span>,</span><br><span class="line">        <span class="string">"background-size"</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"outline"</span>,</span><br><span class="line">        <span class="string">"opacity"</span>,</span><br><span class="line">        <span class="string">"box-shadow"</span>,</span><br><span class="line">        <span class="string">"text-shadow"</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"transition"</span>,</span><br><span class="line">        <span class="string">"transition-delay"</span>,</span><br><span class="line">        <span class="string">"transition-timing-function"</span>,</span><br><span class="line">        <span class="string">"transition-duration"</span>,</span><br><span class="line">        <span class="string">"transition-property"</span>,</span><br><span class="line">        <span class="string">"transform"</span>,</span><br><span class="line">        <span class="string">"transform-origin"</span>,</span><br><span class="line">        <span class="string">"animation"</span>,</span><br><span class="line">        <span class="string">"animation-duration"</span>,</span><br><span class="line">        <span class="string">"animation-delay"</span>,</span><br><span class="line">        <span class="string">"animation-direction"</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">"content"</span>,</span><br><span class="line">        <span class="string">"resize"</span>,</span><br><span class="line">        <span class="string">"cursor"</span>,</span><br><span class="line">        <span class="string">"user-select"</span>,</span><br><span class="line">        <span class="string">"tab-size"</span>,</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="JavaScript规范"><a href="#JavaScript规范" class="headerlink" title="JavaScript规范"></a>JavaScript规范</h2><ul>
<li>遵循<a href="https://standardjs.com/" target="_blank" rel="noopener">standardjs</a>规范<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://eslint.org/docs/user-guide/configuring</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    root: <span class="literal">true</span>,</span><br><span class="line">    parser: <span class="string">'babel-eslint'</span>,</span><br><span class="line">    parserOptions: &#123;</span><br><span class="line">        sourceType: <span class="string">'module'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    env: &#123;</span><br><span class="line">        browser: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// https://github.com/feross/standard/blob/master/RULES.md#javascript-standard-style</span></span><br><span class="line">    extends: <span class="string">'standard'</span>,</span><br><span class="line">    <span class="comment">// required to lint *.vue files</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="string">'html'</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// add your custom rules here</span></span><br><span class="line">    <span class="string">'rules'</span>: &#123;</span><br><span class="line">        <span class="comment">// allow paren-less arrow functions</span></span><br><span class="line">        <span class="string">'arrow-parens'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// allow async-await</span></span><br><span class="line">        <span class="string">'generator-star-spacing'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// allow semi</span></span><br><span class="line">        <span class="string">'semi'</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// allow debugger during development</span></span><br><span class="line">        <span class="string">'no-debugger'</span>: process.env.NODE_ENV === <span class="string">'production'</span> ? <span class="number">2</span> : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Vue规范"><a href="#Vue规范" class="headerlink" title="Vue规范"></a>Vue规范</h2><ul>
<li>请仔细阅读<a href="https://cn.vuejs.org/v2/style-guide/" target="_blank" rel="noopener">vue风格指南</a>!!!</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/22/2019我和前端有一个约定/" data-id="ckrbiagru00006h1tymsaahz5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Css/">Css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Vue和TypeScript的Webpack4-尝鲜" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2018/05/26/Vue和TypeScript的Webpack4-尝鲜/" class="article-date">
  <time datetime="2018-05-26T10:12:45.000Z" itemprop="datePublished">2018-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/26/Vue和TypeScript的Webpack4-尝鲜/">Vue和TypeScript的Webpack4.+尝鲜</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/VuexStorageTS.png" alt="banner"></p>
<blockquote>
<p>静态类型系统能帮助你有效防止许多潜在的运行时错误，而且随着你的应用日渐丰满会更加显著。这就是为什么 Vue 不仅仅为 Vue core 提供了针对 TypeScript 的官方类型声明，还为 Vue Router 和 Vuex 也提供了相应的声明文件</p>
</blockquote>
<h2 id="TsConfig配置"><a href="#TsConfig配置" class="headerlink" title="TsConfig配置"></a>TsConfig配置</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">      <span class="comment">// ts 文件编译成 js 文件的时候，同时生成对应的 map 文件</span></span><br><span class="line">      <span class="string">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"strict"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"strictNullChecks"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 当表达式和申明 类型为any时，是否需要发出警告，设置true，则不警告</span></span><br><span class="line">      <span class="string">"noImplicitAny"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 设置为true时，如果不是函数中的所有路径都有返回值，则提示Error</span></span><br><span class="line">      <span class="string">"noImplicitReturns"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// module 用于指定模块的代码生成规则，可以使用 commonjs 、 amd 、 umd 、 system 、 es6 、 es2015 、 none 这些选项。</span></span><br><span class="line">      <span class="comment">// 选择commonJS，会生成符合commonjs规范的文件，使用amd，会生成满足amd规范的文件，使用system会生成使用ES6的</span></span><br><span class="line">      <span class="comment">// system.import的代码。使用es6或者是es2015会生产包含ES6特性的代码。</span></span><br><span class="line">      <span class="string">"module"</span>: <span class="string">"es2015"</span>,</span><br><span class="line">      <span class="string">"moduleResolution"</span>: <span class="string">"node"</span>,</span><br><span class="line">      <span class="comment">// 设置为true时，则允许从没有默认导出的模块中默认导入(也就是不做检查)</span></span><br><span class="line">      <span class="string">"allowSyntheticDefaultImports"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 设置为true，则支持ES7的装饰器特性</span></span><br><span class="line">      <span class="string">"experimentalDecorators"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// target 用于指定生成代码的兼容版本，可以从es3,es5,es2015,es6中选择一个，如果不设置，默认生产的代码兼容到es3</span></span><br><span class="line">      <span class="string">"target"</span>: <span class="string">"es5"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"include"</span>: [</span><br><span class="line">        <span class="string">"./src/**/*"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置参考： </p>
<ul>
<li><a href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" target="_blank" rel="noopener">官方文档tsconfig解析</a> </li>
<li><a href="http://json.schemastore.org/tsconfig" target="_blank" rel="noopener">tsconfig的JSON文档</a></li>
</ul>
<h2 id="Webpack的基础配置一览"><a href="#Webpack的基础配置一览" class="headerlink" title="Webpack的基础配置一览"></a>Webpack的基础配置一览</h2><p>每个项目最重要的一部分个人感觉是webpack的配置，只有配置好webpack部分后续才能顺利进行开发</p>
<p>这里webpack使用了4.+的版本，所以算是体验了较为新的webpack，其中和旧版的有些区别，这里不做介绍</p>
<p>先贴出webpack的配置代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> VueLoaderPlugin = <span class="built_in">require</span>(<span class="string">'vue-loader/lib/plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: process.env.NODE_ENV === <span class="string">'production'</span> ? <span class="string">'production'</span> : <span class="string">'development'</span>,</span><br><span class="line">  entry: <span class="string">'./src/index.ts'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">    filename: <span class="string">'build.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        loader: <span class="string">'vue-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          loaders: &#123;</span><br><span class="line">            <span class="string">'scss'</span>: <span class="string">'vue-style-loader!css-loader!sass-loader'</span>,</span><br><span class="line">            <span class="string">'sass'</span>: <span class="string">'vue-style-loader!css-loader!sass-loader?indentedSyntax'</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">        loader: <span class="string">'ts-loader'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          transpileOnly: <span class="literal">true</span>,</span><br><span class="line">          appendTsSuffixTo: [<span class="regexp">/.vue$/</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">'.ts'</span>, <span class="string">'.js'</span>, <span class="string">'.vue'</span>, <span class="string">'.josn'</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'vue$'</span>: <span class="string">'vue/dist/vue.esm.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">'./public'</span>,</span><br><span class="line">    host: <span class="string">'localhost'</span>,</span><br><span class="line">    port: <span class="string">'8080'</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    hot: <span class="literal">true</span>,</span><br><span class="line">    inline: <span class="literal">true</span>,</span><br><span class="line">    historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">    noInfo: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  performance: &#123;</span><br><span class="line">    hints: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">'#eval-source-map'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> VueLoaderPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'production'</span>) &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports.devtool = <span class="string">'#source-map'</span></span><br><span class="line">  <span class="built_in">module</span>.exports.plugins = (<span class="built_in">module</span>.exports.plugins || []).concat([</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="string">'process.env'</span>: &#123;</span><br><span class="line">        NODE_ENV: <span class="string">'"production"'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">      sourceMap: <span class="literal">true</span>,</span><br><span class="line">      compress: &#123;</span><br><span class="line">        warnings: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.LoaderOptionsPlugin(&#123;</span><br><span class="line">      minimize: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ])</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">module</span>.exports.plugins = (<span class="built_in">module</span>.exports.plugins || []).concat([</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意点：</p>
<ul>
<li><p>vue-loader v15需要在webpack插件中添加VueLoaderPlugin插件</p>
</li>
<li><p>webpack4.+需要指定mode，开发模式还是生产模式</p>
</li>
<li><p>注意ts-loader的配置</p>
</li>
</ul>
<p>这里只是简单进行webpack配置，没有太完整地根据完整的项目来进行配置，只是简单配置了生产环境下的代码混淆压缩，以及对应的开发服务器和热更新等，有需要其他功能扩展的自行配置。</p>
<h2 id="Vue环境搭建配置"><a href="#Vue环境搭建配置" class="headerlink" title="Vue环境搭建配置"></a>Vue环境搭建配置</h2><h3 id="vue-shims-d-ts的添加"><a href="#vue-shims-d-ts的添加" class="headerlink" title="vue-shims.d.ts的添加"></a>vue-shims.d.ts的添加</h3><p>这个是比较重要的一个配置，该文件需要放到vue的入口文件中，具体的d.ts代码如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> '*.vue' &#123;</span><br><span class="line">  <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> Vue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目的是让ts能够识别到vue的静态类型</p>
<h3 id="vue的入口文件"><a href="#vue的入口文件" class="headerlink" title="vue的入口文件"></a>vue的入口文件</h3><p>index.ts:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="comment">// vuex部分</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>入口文件跟普通的js写法没有太多的区别，只是文件类型为ts。</p>
<h2 id="开始写vue的单文件页面和组件"><a href="#开始写vue的单文件页面和组件" class="headerlink" title="开始写vue的单文件页面和组件"></a>开始写vue的单文件页面和组件</h2><h3 id="单文件页面模板"><a href="#单文件页面模板" class="headerlink" title="单文件页面模板"></a>单文件页面模板</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script lang="ts"&gt;</span></span><br><span class="line"><span class="regexp">  ...</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure>
<p>主要是在script项中把lang写为ts类型</p>
<h3 id="使用装饰器来实现组件和页面"><a href="#使用装饰器来实现组件和页面" class="headerlink" title="使用装饰器来实现组件和页面"></a>使用装饰器来实现组件和页面</h3><p>这里我们主要使用两个装饰器库vue-property-decorator 和 vuex-class, vue-property-decorator其是基于vue-class-得component的基础扩展修改的。</p>
<ol>
<li>大致了解一下vue-property-decorator的装饰器的用法</li>
</ol>
<p>一共有七个装饰器：</p>
<ul>
<li><code>@Emit</code></li>
<li><code>@Inject</code></li>
<li><code>@Model</code></li>
<li><code>@Prop</code></li>
<li><code>@Provide</code></li>
<li><code>@Watch</code></li>
<li><code>@Component</code> (<strong>exported from</strong> <code>vue-class-component</code>)</li>
</ul>
<p>这里使用vue-property-decorator的例子来做解析</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, Emit, Inject, Model, Prop, Provide, Vue, Watch &#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = Symbol(<span class="string">'baz'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> MyComponent <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Emit</span>()</span><br><span class="line">  addToCount(n: <span class="built_in">number</span>)&#123; <span class="keyword">this</span>.count += n &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Emit</span>(<span class="string">'reset'</span>)</span><br><span class="line">  resetCount()&#123; <span class="keyword">this</span>.count = <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span>() foo: <span class="built_in">string</span></span><br><span class="line">  <span class="meta">@Inject</span>(<span class="string">'bar'</span>) bar: <span class="built_in">string</span></span><br><span class="line">  <span class="meta">@Inject</span>(&#123;<span class="keyword">from</span>: <span class="string">'optional'</span>, <span class="keyword">default</span>: <span class="string">'default'</span>&#125;) optional: <span class="built_in">string</span></span><br><span class="line">  <span class="meta">@Inject</span>(s) baz: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Model</span>(<span class="string">'change'</span>) checked: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Prop</span>()</span><br><span class="line">  propA: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Prop</span>(&#123; <span class="keyword">default</span>: <span class="string">'default value'</span> &#125;)</span><br><span class="line">  propB: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Prop</span>([<span class="built_in">String</span>, <span class="built_in">Boolean</span>])</span><br><span class="line">  propC: <span class="built_in">string</span> | <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Provide</span>() foo = <span class="string">'foo'</span></span><br><span class="line">  <span class="meta">@Provide</span>(<span class="string">'bar'</span>) baz = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Watch</span>(<span class="string">'child'</span>)</span><br><span class="line">  onChildChanged(val: <span class="built_in">string</span>, oldVal: <span class="built_in">string</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Watch</span>(<span class="string">'person'</span>, &#123; immediate: <span class="literal">true</span>, deep: <span class="literal">true</span> &#125;)</span><br><span class="line">  onPersonChanged(val: Person, oldVal: Person) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相当于js的写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="built_in">Symbol</span>(<span class="string">'baz'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MyComponent = Vue.extend(&#123;</span><br><span class="line">  name: <span class="string">'MyComponent'</span>,</span><br><span class="line">  inject: &#123;</span><br><span class="line">    foo: <span class="string">'foo'</span>,</span><br><span class="line">    bar: <span class="string">'bar'</span>,</span><br><span class="line">    <span class="string">'optional'</span>: &#123; <span class="attr">from</span>: <span class="string">'optional'</span>, <span class="attr">default</span>: <span class="string">'default'</span> &#125;,</span><br><span class="line">    [s]: s</span><br><span class="line">  &#125;,</span><br><span class="line">  model: &#123;</span><br><span class="line">    prop: <span class="string">'checked'</span>,</span><br><span class="line">    event: <span class="string">'change'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    checked: <span class="built_in">Boolean</span>,</span><br><span class="line">    propA: <span class="built_in">Number</span>,</span><br><span class="line">    propB: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'default value'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    propC: [<span class="built_in">String</span>, <span class="built_in">Boolean</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo: <span class="string">'foo'</span>,</span><br><span class="line">      baz: <span class="string">'bar'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  provide () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo: <span class="keyword">this</span>.foo,</span><br><span class="line">      bar: <span class="keyword">this</span>.baz</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addToCount(n)&#123;</span><br><span class="line">      <span class="keyword">this</span>.count += n</span><br><span class="line">      <span class="keyword">this</span>.$emit(<span class="string">"add-to-count"</span>, n)</span><br><span class="line">    &#125;,</span><br><span class="line">    resetCount()&#123;</span><br><span class="line">      <span class="keyword">this</span>.count = <span class="number">0</span></span><br><span class="line">      <span class="keyword">this</span>.$emit(<span class="string">"reset"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    onChildChanged(val, oldVal) &#123; &#125;,</span><br><span class="line">    onPersonChanged(val, oldVal) &#123; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="string">'child'</span>: &#123;</span><br><span class="line">      handler: <span class="string">'onChildChanged'</span>,</span><br><span class="line">      immediate: <span class="literal">false</span>,</span><br><span class="line">      deep: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'person'</span>: &#123;</span><br><span class="line">      handler: <span class="string">'onPersonChanged'</span>,</span><br><span class="line">      immediate: <span class="literal">true</span>,</span><br><span class="line">      deep: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>相信通过以上的例子我们很容易就看出各个装饰器如何去使用，这里就不再做太多的解释。</p>
<ol start="2">
<li>再看一下vuex-class的使用方法</li>
</ol>
<p>同样举例官方的使用列子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Component <span class="keyword">from</span> <span class="string">'vue-class-component'</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  State,</span><br><span class="line">  Getter,</span><br><span class="line">  Action,</span><br><span class="line">  Mutation,</span><br><span class="line">  namespace</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'vuex-class'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> someModule = namespace(<span class="string">'path/to/module'</span>)</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComp</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  @State(<span class="string">'foo'</span>) stateFoo</span><br><span class="line">  @State(<span class="function"><span class="params">state</span> =&gt;</span> state.bar) stateBar</span><br><span class="line">  @Getter(<span class="string">'foo'</span>) getterFoo</span><br><span class="line">  @Action(<span class="string">'foo'</span>) actionFoo</span><br><span class="line">  @Mutation(<span class="string">'foo'</span>) mutationFoo</span><br><span class="line">  @someModule.Getter(<span class="string">'foo'</span>) moduleGetterFoo</span><br><span class="line"></span><br><span class="line">  @State foo</span><br><span class="line">  @Getter bar</span><br><span class="line">  @Action baz</span><br><span class="line">  @Mutation qux</span><br><span class="line"></span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="keyword">this</span>.stateFoo <span class="comment">// -&gt; store.state.foo</span></span><br><span class="line">    <span class="keyword">this</span>.stateBar <span class="comment">// -&gt; store.state.bar</span></span><br><span class="line">    <span class="keyword">this</span>.getterFoo <span class="comment">// -&gt; store.getters.foo</span></span><br><span class="line">    <span class="keyword">this</span>.actionFoo(&#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;) <span class="comment">// -&gt; store.dispatch('foo', &#123; value: true &#125;)</span></span><br><span class="line">    <span class="keyword">this</span>.mutationFoo(&#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;) <span class="comment">// -&gt; store.commit('foo', &#123; value: true &#125;)</span></span><br><span class="line">    <span class="keyword">this</span>.moduleGetterFoo <span class="comment">// -&gt; store.getters['path/to/module/foo']</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Vuex的配置"><a href="#Vuex的配置" class="headerlink" title="Vuex的配置"></a>Vuex的配置</h2><h3 id="store的入口"><a href="#store的入口" class="headerlink" title="store的入口"></a>store的入口</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex, &#123; StoreOptions &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">'./modules/types'</span></span><br><span class="line"><span class="keyword">import</span> &#123; profile &#125; <span class="keyword">from</span> <span class="string">'./modules/profile'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store: StoreOptions&lt;RootState&gt; = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    version: <span class="string">'v1.0.0'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">    profile</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store&lt;RootState&gt;(store);</span><br></pre></td></tr></table></figure>
<p>这里RootState只是用于留空，目的是为了注入全局的store，区别于modules的状态</p>
<h3 id="vuex的modules的配置"><a href="#vuex的modules的配置" class="headerlink" title="vuex的modules的配置"></a>vuex的modules的配置</h3><ol>
<li>写一个全局类型声明</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RootState &#123;</span><br><span class="line">  version: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>version字段就是我们刚才在RootState中定义的字段</p>
<ol start="2">
<li>定义模板profile</li>
</ol>
<p>profile模块的类型声明:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ProfileState &#123;</span><br><span class="line">  firstName: <span class="built_in">string</span></span><br><span class="line">  lastName: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>profile的模块实现:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RootState &#125; <span class="keyword">from</span> <span class="string">'../types'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ProfileState &#125; <span class="keyword">from</span> <span class="string">'./types'</span></span><br><span class="line"><span class="keyword">import</span> &#123; GetterTree, ActionTree, MutationTree  &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosPromise &#125; <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state: ProfileState = &#123;</span><br><span class="line">  firstName: <span class="string">''</span>,</span><br><span class="line">  lastName: <span class="string">''</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters: GetterTree&lt;ProfileState, RootState&gt; = &#123;</span><br><span class="line">  firstName(state) : <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.firstName</span><br><span class="line">  &#125;,</span><br><span class="line">  lastName(state) : <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state.lastName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions: ActionTree&lt;ProfileState, RootState&gt; = &#123;</span><br><span class="line">  fetchName(&#123; commit &#125;, id: <span class="built_in">number</span>): AxiosPromise&lt;ProfileState&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'action:'</span>, id)</span><br><span class="line">    <span class="keyword">return</span> axios.request(&#123;</span><br><span class="line">      url: <span class="string">'https://www.apiopen.top/satinCommentApi?id=27610708&amp;page=1'</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'setProfile'</span>, &#123;</span><br><span class="line">        firstName: <span class="string">'lin'</span>,</span><br><span class="line">        lastName: <span class="string">'guangyu'</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations: MutationTree&lt;ProfileState&gt; = &#123;</span><br><span class="line">  setProfile(state, payload: ProfileState) &#123;</span><br><span class="line">    state.firstName = payload.firstName</span><br><span class="line">    state.lastName = payload.lastName</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> namespaced: <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> profile: Module&lt;ProfileState, RootState&gt; = &#123;</span><br><span class="line">  namespaced,</span><br><span class="line">  state,</span><br><span class="line">  getters,</span><br><span class="line">  actions,</span><br><span class="line">  mutations</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里我们就完成了Vuex的配置了，就可以结合装饰器对vuex进行调用，而且具有静态类型提示，十分方便。</p>
<p>完成了这一系列的配置我们的尝试已经完成，自己写了个简单的demo，有兴趣可以观看<a href="https://github.com/lgybetter/vue-ts-template" target="_blank" rel="noopener">github</a>怎么配置。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/26/Vue和TypeScript的Webpack4-尝鲜/" data-id="ckrbiagu0002f6h1t1429ypnp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/">TypeScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-React结合TypeScript和Mobx初体验" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2018/05/05/React结合TypeScript和Mobx初体验/" class="article-date">
  <time datetime="2018-05-05T13:16:42.000Z" itemprop="datePublished">2018-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/05/React结合TypeScript和Mobx初体验/">React结合TypeScript和Mobx初体验</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/20180505210245.png" alt="banner"></p>
<h2 id="为什么要使用TypeScript"><a href="#为什么要使用TypeScript" class="headerlink" title="为什么要使用TypeScript"></a>为什么要使用TypeScript</h2><h3 id="侦测错误"><a href="#侦测错误" class="headerlink" title="侦测错误"></a>侦测错误</h3><p>通过静态类型检测可以尽早检测出程序中隐藏的的逻辑错误，对于JavaScript动态的弱类型语言，虽然灵活性高，但是对于初学者来说，如果不熟悉JavaScript内部的语言机制，很容易造成隐藏的事故。但是通过TypeScript的静态类型检测可以规避这些问题，因为其能够约束变量产生的类型。结合IDE编辑器可以推导变量对应的类型以及内部的结构，提高代码的健壮性和可维护性。</p>
<h3 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h3><p>类型系统能够强化规范编程，TypeScript提供定义接口。在开发大型复杂的应用软件时十分重要，一个系统模块可以抽象的看做一个TypeScript定义的接口。让设计脱离实现，最终体现出一种 IDL（接口定义语言，Interface Define Language），让程序设计回归本质。</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>TypeScript可以自动根据类型标注生成文档，对于简单的功能实现都不需要编写注释。</p>
<h2 id="为什么要使用Mobx"><a href="#为什么要使用Mobx" class="headerlink" title="为什么要使用Mobx"></a>为什么要使用Mobx</h2><h3 id="MobX-和-Redux-的比较"><a href="#MobX-和-Redux-的比较" class="headerlink" title="MobX 和 Redux 的比较"></a>MobX 和 Redux 的比较</h3><p>先要明白 mobx 和 redux 的定位是不同的。redux 管理的是 (STORE -&gt; VIEW -&gt; ACTION) 的整个闭环，而 mobx 只关心 STORE -&gt; VIEW 的部分。</p>
<p>Redux优缺点：</p>
<ul>
<li><p>数据流流动很自然，因为任何 dispatch 都会触发广播，依据对象引用是否变化来控制更新粒度。</p>
</li>
<li><p>通过充分利用时间回溯的特征，可以增强业务的可预测性与错误定位能力。</p>
</li>
<li><p>时间回溯代价高，因为每次都要更新引用，除非增加代码复杂度，或使用 immutable。</p>
</li>
<li><p>时间回溯的另一个代价是 action 与 reducer 完全脱节，原因是可回溯必然不能保证引用关系。</p>
</li>
<li><p>引入中间件，解决异步带来的副作用，业务逻辑或多或少参杂着 magic。</p>
</li>
<li><p>灵活利用中间件，可以通过约定完成许多复杂的工作。</p>
</li>
<li><p>对 typescript 支持困难。</p>
</li>
</ul>
<p>Mobx优缺点：</p>
<ul>
<li><p>数据流流动不自然，只有用到的数据才会引发绑定，局部精确更新，但避免了粒度控制烦恼。</p>
</li>
<li><p>没有时间回溯能力，因为数据只有一份引用。自始至终一份引用，不需要 immutable，也没有复制对象的额外开销。</p>
</li>
<li><p>数据流动由函数调用一气呵成，便于调试。</p>
</li>
<li><p>业务开发不是脑力活，而是体力活，少一些 magic，多一些效率。</p>
</li>
<li><p>由于没有 magic，所以没有中间件机制，没法通过 magic 加快工作效率（这里 magic 是指 action 分发到 reducer 的过程）。</p>
</li>
<li><p>完美支持 typescript。</p>
</li>
</ul>
<p>SO: 前端数据流不太复杂的情况，使用 Mobx，因为更加清晰，也便于维护；如果前端数据流极度复杂，建议谨慎使用 Redux，通过中间件减缓巨大业务复杂度</p>
<h2 id="使用Create-React-App来建立TypeScript的环境"><a href="#使用Create-React-App来建立TypeScript的环境" class="headerlink" title="使用Create-React-App来建立TypeScript的环境"></a>使用Create-React-App来建立TypeScript的环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm i -g create-react-app</span><br><span class="line">create-react-app tinylog-ui --scripts-version=react-scripts-ts</span><br><span class="line"><span class="built_in">cd</span> tinylog-ui/</span><br><span class="line">npm start</span><br><span class="line">npm run eject</span><br></pre></td></tr></table></figure>
<p>TPS: 最后一个命令使用eject将所有内建的配置暴露出来</p>
<p>通过create-react-app可以很方便地对整个项目完成环境初始化，如果愿意折腾TypeScript和webpack的环境可以试试，这里忽略webpack和TypeScript的环境搭建过程，而是使用create-react-app来实现环境搭建。</p>
<h2 id="加入React-Router"><a href="#加入React-Router" class="headerlink" title="加入React-Router"></a>加入React-Router</h2><p>单页应用怎么可以没有前端路由呢，所以我们要加入React-Rotuer, 这里使用的React-Router的版本是v4.2.0</p>
<h3 id="路由配置使用姿势"><a href="#路由配置使用姿势" class="headerlink" title="路由配置使用姿势"></a>路由配置使用姿势</h3><p>对于React-Router，这里使用到的模块有Router, Route, Switch</p>
<blockquote>
<p>React Router 是建立在 history 之上的。 简而言之，一个 history 知道如何去监听浏览器地址栏的变化， 并解析这个 URL 转化为 location 对象， 然后 router 使用它匹配到路由，最后正确地渲染对应的组件。</p>
</blockquote>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import * as ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &#123; Router, Route, Switch &#125; from &apos;react-router&apos;;</span><br><span class="line">import &#123; createBrowserHistory &#125; from &apos;history&apos;;</span><br><span class="line">import registerServiceWorker from &apos;./registerServiceWorker&apos;;</span><br><span class="line">import &#123; Root &#125; from &apos;./containers/Root&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import Container from &apos;./containers/Container&apos;;</span><br><span class="line">import SignIn from &apos;./containers/Auth/signIn&apos;;</span><br><span class="line">import SignUp from &apos;./containers/Auth/signUp&apos;;</span><br><span class="line"></span><br><span class="line">const history = createBrowserHistory();</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Root&gt;</span><br><span class="line">    &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &lt;Route</span><br><span class="line">          path=&quot;/signIn&quot;</span><br><span class="line">          component=&#123;SignIn&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Route</span><br><span class="line">          path=&quot;/signUp&quot;</span><br><span class="line">          component=&#123;SignUp&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Route</span><br><span class="line">          path=&quot;/&quot;</span><br><span class="line">          component=&#123;Container&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/Switch&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  &lt;/Root&gt;,</span><br><span class="line">  document.getElementById(&apos;root&apos;) as HTMLElement</span><br><span class="line">);</span><br><span class="line">registerServiceWorker();</span><br></pre></td></tr></table></figure>
<h3 id="页面的编写"><a href="#页面的编写" class="headerlink" title="页面的编写"></a>页面的编写</h3><p>这里描述一写Container这个组件的编写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import Header from &apos;../../layout/Header&apos;;</span><br><span class="line">import &#123; IAuth &#125; from &apos;../../interfaces&apos;;</span><br><span class="line">import &#123; Route, Switch &#125; from &apos;react-router&apos;;</span><br><span class="line">import App from &apos;../App&apos;;</span><br><span class="line">import Website from &apos;../Website&apos;;</span><br><span class="line"></span><br><span class="line">// 这部分是坑点，一开始不知道配置，后发现react-rotuer的4.0版本下需要配置prop的接口</span><br><span class="line">interface Container extends RouteComponentProps&lt;&#123;&#125;&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Container extends React.Component&lt;Container, &#123;&#125;&gt; &#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Header &#123;...this.props&#125; /&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=&quot;/website&quot; component=&#123;Website&#125;/&gt;</span><br><span class="line">          &lt;Route  path=&quot;/&quot; component=&#123;App&#125;/&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Container;</span><br></pre></td></tr></table></figure>
<p>这样，当我们访问url为’/‘的时候，默认会进入Container，其中Container里面是一层子页面，会匹配url，如果url为’/website’, 则进入Website页面，若为’/‘,则进入App页面。</p>
<p>具体关于React-Router的使用请阅读<a href="https://reacttraining.com/react-router/" target="_blank" rel="noopener">React-Router文档</a></p>
<h2 id="加入Mobx"><a href="#加入Mobx" class="headerlink" title="加入Mobx"></a>加入Mobx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mobx react-mobx mobx-react-router -S</span><br></pre></td></tr></table></figure>
<h3 id="重新修改index-tsx的入口配置"><a href="#重新修改index-tsx的入口配置" class="headerlink" title="重新修改index.tsx的入口配置"></a>重新修改index.tsx的入口配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import * as ReactDOM from &apos;react-dom&apos;;</span><br><span class="line">import &#123; Router, Route, Switch &#125; from &apos;react-router&apos;;</span><br><span class="line">import &#123; createBrowserHistory &#125; from &apos;history&apos;;</span><br><span class="line">import &#123; useStrict &#125; from &apos;mobx&apos;;</span><br><span class="line">import &#123; Provider &#125; from &apos;mobx-react&apos;;</span><br><span class="line">import &#123; RouterStore, syncHistoryWithStore &#125; from &apos;mobx-react-router&apos;;</span><br><span class="line">// 定义需要使用到的store来进行数据状态的管理</span><br><span class="line">import &#123; </span><br><span class="line">  TokenStore, </span><br><span class="line">  AuthStore, </span><br><span class="line">  HostStore, </span><br><span class="line">  OverViewStore,</span><br><span class="line">  AssetsStore,</span><br><span class="line">  CommonDataStore,</span><br><span class="line">  PageStore,</span><br><span class="line">  RealTimeStore  </span><br><span class="line">&#125; from &apos;./stores&apos;;</span><br><span class="line">import registerServiceWorker from &apos;./registerServiceWorker&apos;;</span><br><span class="line">import &#123; Root &#125; from &apos;./containers/Root&apos;;</span><br><span class="line">import &apos;./index.css&apos;;</span><br><span class="line">import Container from &apos;./containers/Container&apos;;</span><br><span class="line">import SignIn from &apos;./containers/Auth/signIn&apos;;</span><br><span class="line">import SignUp from &apos;./containers/Auth/signUp&apos;;</span><br><span class="line">// 引入Echarts</span><br><span class="line">import &apos;./macarons&apos;;</span><br><span class="line">import &apos;echarts/map/js/world&apos;;</span><br><span class="line"></span><br><span class="line">// 开启mobx的严格模式，规范数据修改操作只能在action中进行</span><br><span class="line">useStrict(true);</span><br><span class="line"></span><br><span class="line">const browserHistory = createBrowserHistory();</span><br><span class="line">const routerStore =  new RouterStore();</span><br><span class="line">// 同步路由与mobx的数据状态</span><br><span class="line">const history = syncHistoryWithStore(browserHistory, routerStore);</span><br><span class="line">const rootStore = &#123;</span><br><span class="line">  token: new TokenStore(),</span><br><span class="line">  auth: new AuthStore(),</span><br><span class="line">  host: new HostStore(),</span><br><span class="line">  overview: new OverViewStore(),</span><br><span class="line">  assets: new AssetsStore(),</span><br><span class="line">  commmon: new CommonDataStore(),</span><br><span class="line">  page: new PageStore(),</span><br><span class="line">  realtime: new RealTimeStore(),</span><br><span class="line">  router: routerStore</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider &#123;...rootStore&#125;&gt;</span><br><span class="line">    &lt;Root&gt;</span><br><span class="line">      &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=&quot;/signIn&quot;</span><br><span class="line">            component=&#123;SignIn&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=&quot;/signUp&quot;</span><br><span class="line">            component=&#123;SignUp&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Route</span><br><span class="line">            path=&quot;/&quot;</span><br><span class="line">            component=&#123;Container&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/Router&gt;</span><br><span class="line">    &lt;/Root&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  document.getElementById(&apos;root&apos;) as HTMLElement</span><br><span class="line">);</span><br><span class="line">registerServiceWorker();</span><br></pre></td></tr></table></figure>
<h3 id="Container容器的修改"><a href="#Container容器的修改" class="headerlink" title="Container容器的修改"></a>Container容器的修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import Header from &apos;../../layout/Header&apos;;</span><br><span class="line">import &#123; IAuth &#125; from &apos;../../interfaces&apos;;</span><br><span class="line">import &#123; Route, Switch &#125; from &apos;react-router&apos;;</span><br><span class="line">// 使用inject和observer来进行数据监听和数据依赖声明</span><br><span class="line">import &#123; inject, observer &#125; from &apos;mobx-react&apos;;</span><br><span class="line">import App from &apos;../App&apos;;</span><br><span class="line">import Website from &apos;../Website&apos;;</span><br><span class="line"></span><br><span class="line">interface Container extends IAuth &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@inject(&apos;router&apos;, &apos;auth&apos;)</span><br><span class="line">@observer</span><br><span class="line">class Container extends React.Component&lt;Container, &#123;&#125;&gt; &#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Header &#123;...this.props&#125; /&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=&quot;/website&quot; component=&#123;Website&#125;/&gt;</span><br><span class="line">          &lt;Route  path=&quot;/&quot; component=&#123;App&#125;/&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Container;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>@observable 可以在实例字段和属性 getter 上使用。 对于对象的哪部分需要成为可观察的，@observable 提供了细粒度的控制。</p>
</blockquote>
<blockquote>
<p>@inject 相当于Provider 的高阶组件。可以用来从 React 的context中挑选 store 作为 prop 传递给目标组件</p>
</blockquote>
<h3 id="组件的接口定义"><a href="#组件的接口定义" class="headerlink" title="组件的接口定义"></a>组件的接口定义</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  RouterStore,</span><br><span class="line">  AuthStore</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'../stores'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IBase <span class="keyword">extends</span> RouteComponentProps&lt;&#123;&#125;&gt; &#123;</span><br><span class="line">  router: RouterStore;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IAuth <span class="keyword">extends</span> IBase &#123;</span><br><span class="line">  auth: AuthStore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Store的配置"><a href="#Store的配置" class="headerlink" title="Store的配置"></a>Store的配置</h3><p>先看一下RouterStore:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; History &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouterStore <span class="keyword">as</span> BaseRouterStore, syncHistoryWithStore &#125; <span class="keyword">from</span> <span class="string">'mobx-react-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由状态同步</span></span><br><span class="line"><span class="keyword">class</span> RouterStore <span class="keyword">extends</span> BaseRouterStore &#123;</span><br><span class="line">  <span class="keyword">public</span> history;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">history?: History</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">if</span> (history) &#123;</span><br><span class="line">      <span class="keyword">this</span>.history = syncHistoryWithStore(history, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RouterStore;</span><br></pre></td></tr></table></figure>
<p>然后是AuthStore:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ISignIn, ISignUp &#125; <span class="keyword">from</span> <span class="string">'./../interfaces/index'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observable, action &#125; <span class="keyword">from</span> <span class="string">'mobx'</span>;</span><br><span class="line"><span class="keyword">import</span> api <span class="keyword">from</span> <span class="string">'../api/auth'</span>; </span><br><span class="line"><span class="keyword">import</span> &#123; IUser &#125; <span class="keyword">from</span> <span class="string">'../models'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录注册状态</span></span><br><span class="line"><span class="keyword">class</span> AuthStore &#123;</span><br><span class="line">  <span class="meta">@observable</span> token;</span><br><span class="line">  <span class="meta">@observable</span> id;</span><br><span class="line">  <span class="meta">@observable</span> email;</span><br><span class="line">  <span class="keyword">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.token = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.email = <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  setLocalStorage (&#123; id, token, email &#125;: IUser) &#123;</span><br><span class="line">    localStorage.setItem(<span class="string">'id'</span>, id);</span><br><span class="line">    localStorage.setItem(<span class="string">'token'</span>, token);</span><br><span class="line">    localStorage.setItem(<span class="string">'email'</span>, email);</span><br><span class="line">  &#125;</span><br><span class="line">  clearStorage () &#123;</span><br><span class="line">    localStorage.clear();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@action</span> <span class="keyword">async</span> signIn (data: ISignIn) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data: res &#125; = <span class="keyword">await</span> api.signIn(data);</span><br><span class="line">      <span class="keyword">this</span>.id = res.data.id;</span><br><span class="line">      <span class="keyword">this</span>.token = res.data.token;</span><br><span class="line">      <span class="keyword">this</span>.email = res.data.email;</span><br><span class="line">      <span class="keyword">this</span>.setLocalStorage(&#123;</span><br><span class="line">        id: <span class="keyword">this</span>.id,</span><br><span class="line">        token: <span class="keyword">this</span>.token,</span><br><span class="line">        email: <span class="keyword">this</span>.email</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@action</span> <span class="keyword">async</span> signUp (data: ISignUp) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data: res &#125; = <span class="keyword">await</span> api.signUp(data);</span><br><span class="line">      <span class="keyword">this</span>.id = res.data.id;</span><br><span class="line">      <span class="keyword">this</span>.token = res.data.token;</span><br><span class="line">      <span class="keyword">this</span>.email = res.data.email;</span><br><span class="line">      <span class="keyword">this</span>.setLocalStorage(&#123;</span><br><span class="line">        id: <span class="keyword">this</span>.id,</span><br><span class="line">        token: <span class="keyword">this</span>.token,</span><br><span class="line">        email: <span class="keyword">this</span>.email</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@action</span> signOut () &#123;</span><br><span class="line">    <span class="keyword">this</span>.id = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.token = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.email = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">this</span>.clearStorage()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AuthStore;</span><br></pre></td></tr></table></figure>
<p>Auth是用于网站的登录注册事件以及对应的Token的数据状态保存，登录注册事件的接口请求等操作。</p>
<p>具体的有关Mobx的用法请阅读<a href="https://cn.mobx.js.org/" target="_blank" rel="noopener">Mobx文档</a></p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app</span><br><span class="line">├── api             后端提供的接口数据请求</span><br><span class="line">├── components      编写的可复用组件</span><br><span class="line">├── config          侧边栏以及导航栏配置</span><br><span class="line">├── constants       常量编写</span><br><span class="line">├── interfaces      接口编写</span><br><span class="line">├── layout          布局外框</span><br><span class="line">├── stores          mobx的数据状态管理</span><br><span class="line">├── index.css       全局样式</span><br><span class="line">├── index.tsx       页面入口</span><br><span class="line">├── reset.css       浏览器重置样式</span><br></pre></td></tr></table></figure>
<p>本项目使用了Ant-Design来作为依赖的组件库，具体怎么使用以及配置请参考<a href="https://ant.design/docs/react/use-in-typescript-cn" target="_blank" rel="noopener">Ant-Design</a></p>
<p>到这里其实以及完成对React下TypeScript结合React-Router和Mobx的配置。具体的业务模块如何编写有兴趣可以参阅项目<a href="https://github.com/tinylog/tinylog-ui" target="_blank" rel="noopener">tinylog-ui</a></p>
<p>个人表达能力有限，无法描述得太清晰，请见谅！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/05/React结合TypeScript和Mobx初体验/" data-id="ckrbiagty002e6h1t0uqnzb0g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TypeScript/">TypeScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-高举vue-ssr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2018/03/31/高举vue-ssr/" class="article-date">
  <time datetime="2018-03-31T12:25:30.000Z" itemprop="datePublished">2018-03-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/31/高举vue-ssr/">高举 Vue-SSR</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>将同一个组件渲染为服务器端的 HTML 字符串，将它们直接发送到浏览器，最后将静态标记”混合”为客户端上完全交互的应用程序。</p>
</blockquote>
<hr>
<h2 id="SSR的目的"><a href="#SSR的目的" class="headerlink" title="SSR的目的"></a>SSR的目的</h2><p>To solve</p>
<ul>
<li><p>首屏渲染问题</p>
</li>
<li><p>SEO问题</p>
</li>
</ul>
<hr>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vue-ssr</span><br><span class="line">├── build                 (webapck编译配置)</span><br><span class="line">├── components            (vue 页面) </span><br><span class="line">├── dist                  (编译后的静态资源目录)</span><br><span class="line">├── api.js                (请求接口，模拟异步请求)</span><br><span class="line">├── app.js                (创建Vue实例入口)</span><br><span class="line">├── App.vue               (Vue页面入口)</span><br><span class="line">├── entry-client.js       (前端执行入口)</span><br><span class="line">├── entry-server.js       (后端执行入口)</span><br><span class="line">├── index.template.html   (前端渲染模板)</span><br><span class="line">├── router.js             (Vue路由配置)</span><br><span class="line">├── server.js             (Koa服务)</span><br><span class="line">├── store.js              (Vuex数据状态中心配置)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="原理概览"><a href="#原理概览" class="headerlink" title="原理概览"></a>原理概览</h2><p><img src="/images/vue-ssr.png" alt="vue-ssr"></p>
<p>这张图相信很多大佬们都看过N遍了，每个人理解不同，我发表一下自己个人的理解，如果有什么理解错误请原谅我。</p>
<p>先看Source部分，Source部分先由app.js引入Vue全家桶，至于Vue全家桶如何配置后面会说明。app.js其实就是创建一个注册好各种依赖的Vue对象实例，在SPA单页环境下，我们只需要拿到这个Vue实例，然后指定挂载到模板特定的dom结点，然后丢给webpack处理就完事了。但是SSR在此分为两部分，一部分是前端单页，一部分是后端直出。于是，Client entry的作用是挂载Vue对象实例，并由webpack进行编译打包，最后在浏览器渲染。Server entry的作用是拿到Vue对象实例，并处理收集页面中的asynData，获取对应的数据上下文，然后再由webpack解析处理。最后Node Server端中使用weback编译好的两个bundle文件( 服务器需要「服务器 bundle」然后用于服务器端渲染(SSR)，而「客户端 bundle」会发送给浏览器，用于混合静态标记。)，当用户请求页面时候，这时候服务端会先使用SSR来生成对应的页面文档结构，而在用户切换路由则是使用了SPA的模式。</p>
<hr>
<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><h3 id="项目依赖说明"><a href="#项目依赖说明" class="headerlink" title="项目依赖说明"></a>项目依赖说明</h3><p>Koa2 + Vue2 +  Vue-router + Vuex</p>
<h3 id="一切都从路由开始"><a href="#一切都从路由开始" class="headerlink" title="一切都从路由开始"></a>一切都从路由开始</h3><p>先来配置vue-router, 生成router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Bar <span class="keyword">from</span> <span class="string">'./components/Bar.vue'</span></span><br><span class="line"><span class="keyword">import</span> Baz <span class="keyword">from</span> <span class="string">'./components/Baz.vue'</span></span><br><span class="line"><span class="keyword">import</span> Foo <span class="keyword">from</span> <span class="string">'./components/Foo.vue'</span></span><br><span class="line"><span class="keyword">import</span> Item <span class="keyword">from</span> <span class="string">'./components/Item.vue'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createRouter = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">    mode: <span class="string">'history'</span>,</span><br><span class="line">    routes: [</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'/item/:id'</span>, <span class="attr">component</span>: Item &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'/bar'</span>, <span class="attr">component</span>: Bar &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'/baz'</span>, <span class="attr">component</span>: Baz &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">'/foo'</span>, <span class="attr">component</span>: Foo &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为每个请求创建一个新的Vue实例，路由也是如此，通过一个工厂函数来保证每次都是新创建一个Vue路由的新实例。</p>
<h3 id="Vuex-配置"><a href="#Vuex-配置" class="headerlink" title="Vuex 配置"></a>Vuex 配置</h3><p>配置Vuex, 生成store.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchItem &#125; <span class="keyword">from</span> <span class="string">'./api'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">      items: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">      fetchItem (&#123; commit &#125;, id) &#123;</span><br><span class="line">        <span class="keyword">return</span> fetchItem(id).then(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          commit(<span class="string">'setItem'</span>, &#123; id, item &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">      setItem (state, &#123; id, item &#125;) &#123;</span><br><span class="line">        Vue.set(state.items, id, item)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样也是通过一个工厂函数，来创建一个新的Vuex实例并暴露该方法</p>
<h3 id="生成一个Vue的根实例"><a href="#生成一个Vue的根实例" class="headerlink" title="生成一个Vue的根实例"></a>生成一个Vue的根实例</h3><p>创建Vue实例，生成app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"><span class="keyword">import</span> &#123; sync &#125; <span class="keyword">from</span> <span class="string">'vuex-router-sync'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createApp = <span class="function"><span class="params">ssrContext</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> store = createStore()</span><br><span class="line"></span><br><span class="line">  sync(store, router)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    store,</span><br><span class="line">    ssrContext,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; </span><br><span class="line">    app, </span><br><span class="line">    store, </span><br><span class="line">    router </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过使用我们编写的createRouter, createStore来每次都创建新的Vue-router和Vuex实例，保证和Vue的实例一样都是重新创建过的，接着挂载注册router和store到Vue的实例中，提供createApp传入服务端渲染对应的数据上下文。</p>
<p>到此我们已经基本完成source部分的工作了。接着就要考虑如何去编译打包这些文件，让浏览器和Node服务端去运行解析。</p>
<h3 id="先从前端入口文件开始"><a href="#先从前端入口文件开始" class="headerlink" title="先从前端入口文件开始"></a>先从前端入口文件开始</h3><p>前端打包入口文件: entry-client.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; </span><br><span class="line">  app, </span><br><span class="line">  store,</span><br><span class="line">  router </span><br><span class="line">&#125; = createApp()</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__INITIAL_STATE__) &#123;</span><br><span class="line">  store.replaceState(<span class="built_in">window</span>.__INITIAL_STATE__)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.onReady(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  router.beforeResolve(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> matched = router.getMatchedComponents(to)</span><br><span class="line">    <span class="keyword">const</span> prevMatched = router.getMatchedComponents(<span class="keyword">from</span>)</span><br><span class="line">    <span class="keyword">let</span> diffed = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> activated = matched.filter(<span class="function">(<span class="params">c, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> diffed || (diffed = (prevMatched[i] !== c))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> (!activated.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> next()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Promise</span>.all(activated.map(<span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (c.asyncData) &#123;</span><br><span class="line">        <span class="keyword">return</span> c.asyncData(&#123; store, <span class="attr">route</span>: to &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125;).catch(next)</span><br><span class="line">  &#125;)</span><br><span class="line">  app.$mount(<span class="string">'#app'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>客户端的entry只需创建应用程序，并且将其挂载到 DOM 中， 需要注意的是，任然需要在挂载 app 之前调用 router.onReady，因为路由器必须要提前解析路由配置中的异步组件，(如果你有使用异步组件的话，本项目没有使用到异步组件，但后续考虑加入) 才能正确地调用组件中可能存在的路由钩子。通过添加路由钩子函数，用于处理 asyncData，在初始路由 resolve 后执行，以便我们不会二次预取(double-fetch)已有的数据。使用 <code>router.beforeResolve()</code>，以便确保所有异步组件都 resolve，并对比之前没有渲染的组件找出两个匹配列表的差异组件，如果没有差异表示无需处理直接next输出。</p>
<h3 id="再看服务端渲染解析入口文件"><a href="#再看服务端渲染解析入口文件" class="headerlink" title="再看服务端渲染解析入口文件"></a>再看服务端渲染解析入口文件</h3><p>服务端渲染的执行入口文件: entry-server.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> context =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; </span><br><span class="line">      app, </span><br><span class="line">      store,</span><br><span class="line">      router </span><br><span class="line">    &#125; = createApp(context)</span><br><span class="line"></span><br><span class="line">    router.push(context.url)</span><br><span class="line"></span><br><span class="line">    router.onReady(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> matchedComponents = router.getMatchedComponents()</span><br><span class="line">      <span class="keyword">if</span> (!matchedComponents.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(&#123; <span class="attr">code</span>: <span class="number">404</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">Promise</span>.all(matchedComponents.map(<span class="function"><span class="params">Component</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Component.asyncData) &#123;</span><br><span class="line">          <span class="keyword">return</span> Component.asyncData(&#123;</span><br><span class="line">            store,</span><br><span class="line">            route: router.currentRoute</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        context.state = store.state</span><br><span class="line">        resolve(app)</span><br><span class="line">      &#125;).catch(reject)</span><br><span class="line">    &#125;, reject)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务器 entry 使用 default export 导出函数，并在每次渲染中重复调用此函数。此时，创建和返回应用程序实例之外，还在此执行服务器端路由匹配(server-side route matching)和数据预取逻辑(data pre-fetching logic)。在所有预取钩子(preFetch hook) resolve 后，我们的 store 现在已经填充入渲染应用程序所需的状态。当我们将状态附加到上下文，并且 <code>template</code> 选项用于 renderer 时，状态将自动序列化为 <code>window.__INITIAL_STATE__</code>，并注入 HTML。</p>
<h3 id="激动人心的来写webpack"><a href="#激动人心的来写webpack" class="headerlink" title="激动人心的来写webpack"></a>激动人心的来写webpack</h3><p>直接上手weback4.x版本</p>
<p>webpack配置分为3个配置，公用配置，客户端配置，服务端配置。</p>
<p>三个配置文件以此如下：</p>
<p>base config:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devtool: <span class="string">'#cheap-module-source-map'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">'../dist'</span>),</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    filename: <span class="string">'[name]-[chunkhash].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'public'</span>: path.resolve(__dirname, <span class="string">'../public'</span>),</span><br><span class="line">      <span class="string">'components'</span>: path.resolve(__dirname, <span class="string">'../components'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    extensions: [<span class="string">'.js'</span>, <span class="string">'.vue'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'vue-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        use: <span class="string">'babel-loader'</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: <span class="string">'css-loader'</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  performance: &#123;</span><br><span class="line">    maxEntrypointSize: <span class="number">300000</span>,</span><br><span class="line">    hints: <span class="string">'warning'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">      filename: <span class="string">'common.[chunkhash].css'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>改配置只是简单的配置vue, css, babel等loader的使用，接着ExtractTextPlugin提取css资源文件，指定输出的目录，而入口文件则分别在client和server的config中配置。</p>
<p>client config</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.config.js'</span>)</span><br><span class="line"><span class="keyword">const</span> VueSSRClientPlugin = <span class="built_in">require</span>(<span class="string">'vue-server-renderer/client-plugin'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  entry: path.resolve(__dirname, <span class="string">'../entry-client.js'</span>),</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> VueSSRClientPlugin()</span><br><span class="line">  ],</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        commons: &#123;</span><br><span class="line">          chunks: <span class="string">'initial'</span>,</span><br><span class="line">          minChunks: <span class="number">2</span>, <span class="attr">maxInitialRequests</span>: <span class="number">5</span>,</span><br><span class="line">          minSize: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">          chunks: <span class="string">'initial'</span>,</span><br><span class="line">          name: <span class="string">'vendor'</span>,</span><br><span class="line">          priority: <span class="number">10</span>,</span><br><span class="line">          enforce: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    runtimeChunk: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>客户端的入口文件，使用VueSSRClientPlugin生成对应的vue-ssr-client-manifest.json的映射文件，然后添加vendor的chunk分离。</p>
<p>server config</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">'webpack-node-externals'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.config.js'</span>)</span><br><span class="line"><span class="keyword">const</span> VueSSRServerPlugin = <span class="built_in">require</span>(<span class="string">'vue-server-renderer/server-plugin'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  <span class="comment">// 将 entry 指向应用程序的 server entry 文件</span></span><br><span class="line">  entry: path.resolve(__dirname, <span class="string">'../entry-server.js'</span>),</span><br><span class="line">  <span class="comment">// 允许 webpack Node 适用方式(Node-appropriate fashion)处理动态导入(dynamic import)，</span></span><br><span class="line">  target: <span class="string">'node'</span>,</span><br><span class="line">  <span class="comment">// 提供 source map 支持</span></span><br><span class="line">  devtool: <span class="string">'source-map'</span>,</span><br><span class="line">  <span class="comment">// 使用 Node 风格导出模块(Node-style exports)</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'server-bundle.js'</span>,</span><br><span class="line">    libraryTarget: <span class="string">'commonjs2'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  externals: nodeExternals(&#123;</span><br><span class="line">    <span class="comment">// 不要外置化 webpack 需要处理的依赖模块。</span></span><br><span class="line">    <span class="comment">// 你可以在这里添加更多的文件类型。例如，未处理 *.vue 原始文件，</span></span><br><span class="line">    <span class="comment">// 你还应该将修改 `global`（例如 polyfill）的依赖模块列入白名单</span></span><br><span class="line">    whitelist: <span class="regexp">/\.css$/</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// 这是将服务器的整个输出</span></span><br><span class="line">  <span class="comment">// 构建为单个 JSON 文件的插件。</span></span><br><span class="line">  <span class="comment">// 默认文件名为 `vue-ssr-server-bundle.json`</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> VueSSRServerPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>到此打包的流程已经结束了，server端配置参考了官网的注释。</p>
<h3 id="使用Koa2"><a href="#使用Koa2" class="headerlink" title="使用Koa2"></a>使用Koa2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createBundleRenderer &#125; = <span class="built_in">require</span>(<span class="string">'vue-server-renderer'</span>)</span><br><span class="line"><span class="keyword">const</span> serverBundle = <span class="built_in">require</span>(<span class="string">'./dist/vue-ssr-server-bundle.json'</span>)</span><br><span class="line"><span class="keyword">const</span> clientManifest = <span class="built_in">require</span>(<span class="string">'./dist/vue-ssr-client-manifest.json'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> KoaRuoter = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)</span><br><span class="line"><span class="keyword">const</span> serve = <span class="built_in">require</span>(<span class="string">'koa-static'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> KoaRuoter()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> template = fs.readFileSync(path.resolve(<span class="string">'./index.template.html'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> renderer = createBundleRenderer(serverBundle, &#123;</span><br><span class="line">  <span class="comment">// 推荐</span></span><br><span class="line">  runInNewContext: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// （可选）页面模板</span></span><br><span class="line">  template, </span><br><span class="line">  <span class="comment">// （可选）客户端构建 manifest</span></span><br><span class="line">  clientManifest </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(serve(path.resolve(__dirname, <span class="string">'./dist'</span>)))</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'*'</span>, (ctx, next) =&gt; &#123;</span><br><span class="line">  ctx.set(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handleError = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err &amp;&amp; err.code === <span class="number">404</span>) &#123;</span><br><span class="line">          ctx.status = <span class="number">404</span></span><br><span class="line">          ctx.body = <span class="string">'404 | Page Not Found'</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ctx.status = <span class="number">500</span></span><br><span class="line">          ctx.body = <span class="string">'500 | Internal Server Error'</span></span><br><span class="line">          <span class="built_in">console</span>.error(<span class="string">`error during render : <span class="subst">$&#123;ctx.url&#125;</span>`</span>)</span><br><span class="line">          <span class="built_in">console</span>.error(err.stack)</span><br><span class="line">      &#125;</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(ctx.url)</span><br><span class="line">    <span class="keyword">const</span> context = &#123; <span class="attr">url</span>: ctx.url, <span class="attr">title</span>: <span class="string">'Vue SSR'</span> &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 这里无需传入一个应用程序，因为在执行 bundle 时已经自动创建过。</span></span><br><span class="line">    <span class="comment">// 现在我们的服务器与应用程序已经解耦！</span></span><br><span class="line">    renderer.renderToString(context, (err, html) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 处理异常……</span></span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        handleError(err)</span><br><span class="line">      &#125;</span><br><span class="line">      ctx.body = html</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods())</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span></span><br><span class="line">app.listen(port, <span class="string">'127.0.0.1'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`server running at localhost:<span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>最后效果当然是这样的了:</p>
<p><img src="/images/vue-ssr-res.png" alt="预览"></p>
<p>参考文档:</p>
<p><a href="https://ssr.vuejs.org/zh/," title="vue-ssr官方文档" target="_blank" rel="noopener">vue-ssr官方文档</a></p>
<p>代码仓库:</p>
<p><a href="https://github.com/lgybetter/vue-ssr-template," title="github 链接" target="_blank" rel="noopener">github链接</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/03/31/高举vue-ssr/" data-id="ckrbiague00336h1t6qufpviw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node/">Node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-This浅析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta" style="height: 28px;">
    <a href="/2017/11/14/This浅析/" class="article-date">
  <time datetime="2017-11-13T16:02:26.000Z" itemprop="datePublished">2017-11-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/前端/">前端</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/14/This浅析/">This浅析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/you-don-kown.jpg" alt="你不知道的js"></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul>
<li>this的绑定和函数的声明位置没有任何关系，只取决于函数的调用方式。当一个函数被调用时，会创建一个活动记录（有时候也称为执行上下文）。这个记录会包含函数在哪里被调用（调用栈），函数的调用方式，传入的参数等信息。this就是这个记录的一个属性，会在函数执行的过程中用到。</li>
</ul>
<h2 id="调用位置"><a href="#调用位置" class="headerlink" title="调用位置"></a>调用位置</h2><ul>
<li>调用位置就是函数在代码中被调用的位置（而不是声明位置）</li>
</ul>
<h2 id="绑定规则"><a href="#绑定规则" class="headerlink" title="绑定规则"></a>绑定规则</h2><ul>
<li>默认绑定</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line">foo() <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>当函数调用直接使用不带任何修饰的函数引用进行调用时，在非严格模式下，这时this会绑定到全局对象window/global，而在严格模式下，就会绑定到undefined</p>
<ul>
<li>隐式绑定</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">2</span>,</span><br><span class="line">  foo: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.foo() <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>当函数引用拥有上下文对象时，隐式绑定规则会把函数调用中的this绑定到这个上下文对象。因为调用foo()时this被绑定到obj，因此this.a和obj.a是一样的。</p>
<ul>
<li>隐式丢失</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">2</span>,</span><br><span class="line">  foo: foo</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = obj.foo <span class="comment">// 函数别名</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'lgybetter'</span></span><br><span class="line">bar() <span class="comment">// 'lgybetter'</span></span><br></pre></td></tr></table></figure>
<p>虽然bar是obj.foo的一个引用，但是它引用的是foo函数本身，因此此时的bar()其实是一个不带任何修饰的函数调用，使用了默认绑定(非严格模式)</p>
<ul>
<li>参数传递引起的隐式绑定</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">2</span>,</span><br><span class="line">  foo: foo</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'lgybetter'</span></span><br><span class="line">setTimeout(obj.foo, <span class="number">100</span>) <span class="comment">// 'lgybetter'</span></span><br></pre></td></tr></table></figure>
<p>JavaScript环境内置的setTimeout()函数实现和以下伪代码类似：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setTimeout</span> (<span class="params">fn, delay</span>) </span>&#123;</span><br><span class="line">  fn() <span class="comment">// &lt;--- 调用位置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>显示绑定：</p>
<ul>
<li>call 和 apply：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line">foo.call(obj) <span class="comment">// 2</span></span><br><span class="line">foo.apply(obj) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>简单使用call和apply显示绑定无法解决丢失绑定问题</p>
<ul>
<li><p>硬绑定</p>
<ul>
<li>手动创建函数强制绑定</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  foo.call(obj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar() <span class="comment">// 2</span></span><br><span class="line">setTimeout(bar, <span class="number">100</span>) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 硬绑定的bar不可能再修改它的this</span></span><br><span class="line">bar.call(<span class="built_in">window</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>通过创建bar()，并在它的内部手动调用foo.call(obj)，因此强制把foo的this绑定到了obj</p>
<ul>
<li>创建一个可以重复使用的函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">something</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.a, something)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.a + something</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bind</span> (<span class="params">fn, obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn.apply(obj, <span class="built_in">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  a: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = bind(foo, obj)</span><br><span class="line"><span class="keyword">var</span> b = bar(<span class="number">3</span>) <span class="comment">// 2 3</span></span><br><span class="line"><span class="built_in">console</span>.log(b) <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
<p>由于硬绑定式一种非常常用的模式，于是ES5提供了内置方法Function.prototype.bind，bind会返回一个硬编码的新函数，它会把你指定的参数设置为this的上下文并调用原始函数。</p>
<ul>
<li>API调用的”上下文”：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(el, <span class="keyword">this</span>.id)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  id: <span class="string">'lgybetter'</span></span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].forEach(foo, obj)</span><br><span class="line"><span class="comment">// 1 lgybetter 2 lgybetter 3 lgybetter</span></span><br></pre></td></tr></table></figure>
<ul>
<li>new绑定:</li>
</ul>
<p>JavaScript中构造函数只是一些使用new操作符时被调用的函数。它们并不会属于某个类，也不会实例化一个类。它们就是被new操作符调用的普通函数而已。<br>实际上，不存在所谓的构造函数，只有对函数的“构造调用”。</p>
<p>new调用函数操作：</p>
<ol>
<li>创建一个全新的对象</li>
<li>新对象会被执行[[Prototype]]连接</li>
<li>新对象会绑定到函数调用的this</li>
<li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.a = a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> Foo(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(bar.a) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>使用new来调用Foo(…)， 会构造一个新对象并把它绑定到Foo(…)调用中的this上。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/11/14/This浅析/" data-id="ckrbiagsg00066h1tbsznfjp6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/后端/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础知识/">基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/客户端/">客户端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Browser/">Browser</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/">Css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Electron/">Electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Html/">Html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http/">Http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/">OpenCV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreeJs/">ThreeJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wechat/">Wechat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安卓/">安卓</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机网络/">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Browser/" style="font-size: 10px;">Browser</a> <a href="/tags/Css/" style="font-size: 15px;">Css</a> <a href="/tags/Electron/" style="font-size: 10px;">Electron</a> <a href="/tags/Html/" style="font-size: 10px;">Html</a> <a href="/tags/Http/" style="font-size: 12.5px;">Http</a> <a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/MongoDB/" style="font-size: 12.5px;">MongoDB</a> <a href="/tags/Node/" style="font-size: 17.5px;">Node</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/ThreeJs/" style="font-size: 10px;">ThreeJs</a> <a href="/tags/TypeScript/" style="font-size: 12.5px;">TypeScript</a> <a href="/tags/Vue/" style="font-size: 20px;">Vue</a> <a href="/tags/Wechat/" style="font-size: 10px;">Wechat</a> <a href="/tags/安卓/" style="font-size: 15px;">安卓</a> <a href="/tags/计算机网络/" style="font-size: 10px;">计算机网络</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/19/ReactDOM-render实现浅析/">ReactDOM.render 初始化过程浅析</a>
          </li>
        
          <li>
            <a href="/2020/02/16/React下Hooks使用姿势/">React下Hooks使用姿势</a>
          </li>
        
          <li>
            <a href="/2019/12/30/从零开始打造属于自己的UI库/">从零开始打造属于自己的UI库</a>
          </li>
        
          <li>
            <a href="/2019/07/28/Vue源码解析之Watcher原理/">Vue源码解析之Watcher原理</a>
          </li>
        
          <li>
            <a href="/2019/07/03/Vue源码浅析之Computed初始化/">Vue源码浅析之Computed初始化</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 betterlin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">个人</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>